<div class="w-100">
  <nb-card [nbSpinner]="isLoadingResults">
    <nb-card-header class="d-flex flex-column flex-md-row">
      <div class="col-12 col-md-6 d-flex align-items-center px-0">
        Abaixo, a lista de usuários registrados
      </div>

      <div class="col-12 col-md-6 d-flex justify-content-end px-0"
           *nbIsGranted="['create', 'user']">
        <button nbButton
                status="success"
                outline
                class="w-100 w-md-auto mt-3 mt-md-0"
                routerLink="/pages/users/create">
          Criar novo usuário
        </button>
      </div>
    </nb-card-header>
    <nb-card-body>
      <div class="d-flex justify-content-center w-100 my-2" style="flex: 1;">
        <div class="pl-0 col-12 col-md-2">
          <nb-toggle [(checked)]="includeOnlyActives" (checkedChange)="reloadOnFirstPage()">Apenas Ativos?</nb-toggle>
        </div>

        <div class="pl-0 col-12 col-md-7">
          <input nbInput fullWidth shape="round" placeholder="Pesquisar usuário" #input>
        </div>

        <div class="col-12 col-md-3">
          <button nbButton
                  shape="round"
                  status="info"
                  outline
                  class="w-100 mt-3 mt-md-0"
                  (click)="onClickExport('Lista de Usuários')">
            Exportar
          </button>
        </div>
      </div>

      <table class="w-100" mat-table matSort [dataSource]="dataSource" (matSortChange)="onChangeSort($event)">

        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>E-mail</th>
          <td mat-cell *matCellDef="let element">{{ element.email }}</td>
        </ng-container>

        <ng-container matColumnDef="roles">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Permissões</th>
          <td mat-cell *matCellDef="let element">{{ element.roles | role }}</td>
        </ng-container>

        <ng-container matColumnDef="createdAt">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Criado em</th>
          <td mat-cell *matCellDef="let element">{{ element.createdAt | date:'dd/MM/yyyy HH:mm:ss' }}</td>
        </ng-container>

        <ng-container matColumnDef="updatedAt">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Última Atualização</th>
          <td mat-cell *matCellDef="let element">{{ element.updatedAt | date:'dd/MM/yyyy HH:mm:ss' }}</td>
        </ng-container>

        <ng-container matColumnDef="isActive">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Ativo?</th>
          <td mat-cell *matCellDef="let element">
            <ng-container *ngIf="element.isActive">
              <span class="text-success">Sim</span>
            </ng-container>
            <ng-container *ngIf="!element.isActive">
              <span class="text-danger">Não</span>
            </ng-container>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> Ações</th>
          <td mat-cell *matCellDef="let element">
            <a nbButton
               status="warning"
               outline
               class="mx-2"
               *nbIsGranted="['update', 'user']"
               [routerLink]="['/pages/users/', element.id]">
              <nb-icon icon="edit-outline"></nb-icon>
            </a>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <mat-paginator [pageSizeOptions]="[30]" [hidePageSize]="true" (page)="onPageChange($event)" showFirstLastButtons></mat-paginator>
    </nb-card-body>
  </nb-card>
</div>

<ng-template #deleteTemplate let-element>
  <ngx-alert-delete-modal message="Você tem certeza que deseja remover esse usuário de forma permanente?"
                          (onDelete)="onClickToDelete(element)"></ngx-alert-delete-modal>
</ng-template>
